// SPDX-License-Identifier: GPL-3.0-only OR Apache-2.0 OR MIT
// SPDX-FileCopyrightText: 2024 Charles Wong <charlie-wong@outlook.com>
// Created By: Charles Wong 2024-07-05T05:08:00+08:00 Asia/Shanghai
// Repository: https://github.com/xwlc/mini-logo
class LunarCalendar{static Gan=["甲","乙","丙","丁","戊","己","庚","辛","壬","癸"];static Zhi=["子","丑","寅","卯","辰","巳","午","未","申","酉","戌","亥"];static Animals=["鼠","牛","虎","兔","龙","蛇","马","羊","猴","鸡","狗","猪"];static JieQi=["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"];static MIN_YEAR=1900;static MAX_YEAR=2100;static LunarLeapInfo=[19416,19168,42352,21717,53856,55632,91476,22176,39632,21970,19168,42422,42192,53840,119381,46400,54944,44450,38320,84343,18800,42160,46261,27216,27968,109396,11104,38256,21234,18800,25958,54432,59984,92821,23248,11104,100067,37600,116951,51536,54432,120998,46416,22176,107956,9680,37584,53938,43344,46423,27808,46416,86869,19872,42416,83315,21168,43432,59728,27296,44710,43856,19296,43748,42352,21088,62051,55632,23383,22176,38608,19925,19152,42192,54484,53840,54616,46400,46752,103846,38320,18864,43380,42160,45690,27216,27968,44870,43872,38256,19189,18800,25776,29859,59984,27480,23232,43872,38613,37600,51552,55636,54432,55888,30034,22176,43959,9680,37584,51893,43344,46240,47780,44368,21977,19360,42416,86390,21168,43312,31060,27296,44368,23378,19296,42726,42208,53856,60005,54576,23200,30371,38608,19195,19152,42192,118966,53840,54560,56645,46496,22224,21938,18864,42359,42160,43600,111189,27936,44448,84835,37744,18936,18800,25776,92326,59984,27424,108228,43744,37600,53987,51552,54615,54432,55888,23893,22176,42704,21972,21200,43448,43344,46240,46758,44368,21920,43940,42416,21168,45683,26928,29495,27296,44368,84821,19296,42352,21732,53600,59752,54560,55968,92838,22224,19168,43476,41680,53584,62034,54560];static SolarJieQi=["9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd0b06bdb0722c965ce1cfcc920f","b027097bd097c36b0b6fc9274c91aa","9778397bd19801ec9210c965cc920e","97b6b97bd19801ec95f8c965cc920f","97bd09801d98082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd197c36c9210c9274c91aa","97b6b97bd19801ec95f8c965cc920e","97bd09801d98082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec95f8c965cc920e","97bcf97c3598082c95f8e1cfcc920f","97bd097bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c3598082c95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf97c359801ec95f8c965cc920f","97bd097bd07f595b0b6fc920fb0722","9778397bd097c36b0b6fc9210c8dc2","9778397bd19801ec9210c9274c920e","97b6b97bd19801ec95f8c965cc920f","97bd07f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c920e","97b6b97bd19801ec95f8c965cc920f","97bd07f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c91aa","97b6b97bd19801ec9210c965cc920e","97bd07f1487f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c965cc920e","97bcf7f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b97bd19801ec9210c9274c920e","97bcf7f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c91aa","97b6b97bd197c36c9210c9274c920e","97bcf7f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c8dc2","9778397bd097c36c9210c9274c920e","97b6b7f0e47f531b0723b0b6fb0722","7f0e37f5307f595b0b0bc920fb0722","7f0e397bd097c36b0b6fc9210c8dc2","9778397bd097c36b0b70c9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e37f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc9210c8dc2","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9274c91aa","97b6b7f0e47f531b0723b0787b0721","7f0e27f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c91aa","97b6b7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","9778397bd097c36b0b6fc9210c8dc2","977837f0e37f149b0723b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f5307f595b0b0bc920fb0722","7f0e397bd097c35b0b6fc9210c8dc2","977837f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0721","7f0e37f1487f595b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc9210c8dc2","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd097c35b0b6fc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0787b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0b0bb0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14998082b0723b06bd","7f07e7f0e37f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e397bd07f595b0b0bc920fb0722","977837f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f1487f595b0b0bb0b6fb0722","7f0e37f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e37f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e37f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f1487f531b0b0bb0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0723b06bd","7f07e7f0e47f149b0723b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14998082b0723b06bd","7f07e7f0e37f14998083b0787b0721","7f0e27f0e47f531b0723b0b6fb0722","7f0e37f0e366aa89801eb072297c35","7ec967f0e37f14898082b0723b02d5","7f07e7f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e36665b66aa89801e9808297c35","665f67f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b0721","7f07e7f0e47f531b0723b0b6fb0722","7f0e36665b66a449801e9808297c35","665f67f0e37f14898082b0723b02d5","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e36665b66a449801e9808297c35","665f67f0e37f14898082b072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e26665b66a449801e9808297c35","665f67f0e37f1489801eb072297c35","7ec967f0e37f14998082b0787b06bd","7f07e7f0e47f531b0723b0b6fb0721","7f0e27f1487f531b0b0bb0b6fb0722"];static getLeapMonth(b){return 15&LunarCalendar.LunarLeapInfo[b-LunarCalendar.MIN_YEAR]}static getDaysOfLeapMonth(b){return LunarCalendar.getLeapMonth(b)?65536&LunarCalendar.LunarLeapInfo[b-LunarCalendar.MIN_YEAR]?30:29:0}static getDaysOfYear(b){let f,e=348;for(f=32768;f>8;f>>=1)e+=LunarCalendar.LunarLeapInfo[b-LunarCalendar.MIN_YEAR]&f?1:0;return e+LunarCalendar.getDaysOfLeapMonth(b)}static getDaysOfMonth(b,f){return f>12||f<1?-1:LunarCalendar.LunarLeapInfo[b-LunarCalendar.MIN_YEAR]&65536>>f?30:29}static getGanZhiYear(b){let f=(b-3)%10,e=(b-3)%12;return 0===f&&(f=10),0===e&&(e=12),{gan:LunarCalendar.Gan[f-1],zhi:LunarCalendar.Zhi[e-1],ani:LunarCalendar.Animals[e-1]}}static getAnimalOfYear(b){return LunarCalendar.getGanZhiYear(b).ani}static toGanZhi(b){const f=b%10,e=b%12;return{gan:LunarCalendar.Gan[f],zhi:LunarCalendar.Zhi[e]}}static getSolarMonthDayAtJieQi(b,f){if(b<LunarCalendar.MIN_YEAR||b>LunarCalendar.MAX_YEAR||f<1||f>24)return-1;const e=[],c=LunarCalendar.SolarJieQi[b-LunarCalendar.MIN_YEAR];for(let b=0;b<c.length;b+=5){const f=parseInt("0x"+c.substr(b,5)).toString();e.push(f[0],f.substr(1,2),f[3],f.substr(4,2))}return parseInt(e[f-1])}static isSolarLeapYear(b){return b%400==0?1:b%100==0?0:b%4==0?1:0}static getSolarDaysOfMonth(b,f){if(f>12||f<1)return-1;const e=f-1;if(1===e)return LunarCalendar.isSolarLeapYear(b)?29:28;return[31,28,31,30,31,30,31,31,30,31,30,31][e]}static convTimeToGanZhi(b,f){const e={"00":{name:"子",nick:"夜半",geng:"三更",t1:{h:"23",n:"初"},t2:{h:"00",n:"正"},desc:{n:"困敦",d:"混沌万物之初萌, 藏黄泉之下"}},"02":{name:"丑",nick:"鸡鸣",geng:"四更",t1:{h:"01",n:"初"},t2:{h:"02",n:"正"},desc:{n:"赤奋若",d:"气运奋迅而起, 万物无不若其性"}},"04":{name:"寅",nick:"平旦",geng:"五更",t1:{h:"03",n:"初"},t2:{h:"04",n:"正"},desc:{n:"摄提格",d:"万物承阳而起"}},"06":{name:"卯",nick:"日出",geng:"",t1:{h:"05",n:"初"},t2:{h:"06",n:"正"},desc:{n:"单阏",d:"阳气推万物而起"}},"08":{name:"辰",nick:"食时",geng:"",t1:{h:"07",n:"初"},t2:{h:"08",n:"正"},desc:{n:"执徐",d:"伏蛰之物, 而敷舒出"}},10:{name:"巳",nick:"隅中",geng:"",t1:{h:"09",n:"初"},t2:{h:"10",n:"正"},desc:{n:"大荒落",d:"万物炽盛而出, 霍然落之"}},12:{name:"午",nick:"日中",geng:"",t1:{h:"11",n:"初"},t2:{h:"12",n:"正"},desc:{n:"敦牂",d:"万物壮盛也"}},14:{name:"未",nick:"日昳",geng:"",t1:{h:"13",n:"初"},t2:{h:"14",n:"正"},desc:{n:"协洽",d:"阴阳和合，万物化生"}},16:{name:"申",nick:"日晡",geng:"",t1:{h:"15",n:"初"},t2:{h:"16",n:"正"},desc:{n:"涒滩",d:"万物吐秀, 倾垂也"}},18:{name:"酉",nick:"日入",geng:"",t1:{h:"17",n:"初"},t2:{h:"18",n:"正"},desc:{n:"作噩",d:"万物皆芒枝起"}},20:{name:"戌",nick:"日暮",geng:"一更",t1:{h:"19",n:"初"},t2:{h:"20",n:"正"},desc:{n:"阉茂",d:"万物皆蔽冒也"}},22:{name:"亥",nick:"人定",geng:"二更",t1:{h:"21",n:"初"},t2:{h:"22",n:"正"},desc:{n:"大渊献",d:"万物于天, 深盖藏也"}}},c=new Date;b&&f||(b=c.getHours(),f=c.getMinutes()),24==b&&(b=0);let a={pre:"",now:b.toString(),nxt:""};a.nxt=b+1<24?(b+1).toString():"00",a.pre=b-1>=0?(b-1).toString():"23";let n={};return a.pre=a.pre.padStart(2,"0"),a.now=a.now.padStart(2,"0"),a.nxt=a.nxt.padStart(2,"0"),n=e[a.now]?e[a.now]:e[a.pre].t1.h==b.toString().padStart(2,"0")||e[a.pre].t2.h==b.toString().padStart(2,"0")?e[a.pre]:e[a.nxt],n.mins=function(b){return b<=15?"一刻":b<=30?"二刻":b<=45?"三刻":"四刻"}(f),{ok:1,now:{h:b,m:f},sci:n}}static convSolarToLunar(b,f,e){let c=parseInt(b),a=parseInt(f),n=parseInt(e);if(c<LunarCalendar.MIN_YEAR||c>LunarCalendar.MAX_YEAR)return{ok:0};if(c===LunarCalendar.MIN_YEAR&&1===a&&n<31)return{ok:0};let d,r=!1;c&&a&&n?d=new Date(c,parseInt(a)-1,n):(r=!0,d=new Date),c=d.getFullYear(),a=d.getMonth()+1,n=d.getDate();let t={};switch(t.id=d.getDay(),0===t.id&&(t.id=7),t.id){case 1:t.zh="周一",t.abbr="Mon.",t.en="Monday";break;case 2:t.zh="周二",t.abbr="Tue.",t.en="Tuesday";break;case 3:t.zh="周三",t.abbr="Wed.",t.en="Wednesday";break;case 4:t.zh="周四",t.abbr="Thu.",t.en="Thursday";break;case 5:t.zh="周五",t.abbr="Fri.",t.en="Friday";break;case 6:t.zh="周六",t.abbr="Sat.",t.en="Saturday";break;case 7:t.zh="周日",t.abbr="Sun.",t.en="Sunday"}let i=Date.UTC(c,a-1,n);const s=864e5;i=(i-Date.UTC(LunarCalendar.MIN_YEAR,0,31))/s;let u,l=0;for(u=LunarCalendar.MIN_YEAR;u<=LunarCalendar.MAX_YEAR&&i>0;u++)l=LunarCalendar.getDaysOfYear(u),i-=l;i<0&&(i+=l,u--);const o=u;let h=!1,g=LunarCalendar.getLeapMonth(u);for(u=1;u<13&&i>0;u++)g>0&&u===g+1&&!1===h?(--u,h=!0,l=LunarCalendar.getDaysOfLeapMonth(o)):l=LunarCalendar.getDaysOfMonth(o,u),!0===h&&u===g+1&&(h=!1),i-=l;0===i&&g>0&&u===g+1&&(h?h=!1:(h=!0,--u)),i<0&&(i+=l,--u);const L=u,C=i+1,p=LunarCalendar.getSolarMonthDayAtJieQi(c,2*a-1),M=LunarCalendar.getSolarMonthDayAtJieQi(c,2*a);let m,k,A;m=LunarCalendar.getGanZhiYear(o),k=LunarCalendar.toGanZhi(12*(c-LunarCalendar.MIN_YEAR)+a+11),n>=p&&(k=LunarCalendar.toGanZhi(12*(c-LunarCalendar.MIN_YEAR)+a+12));let S={},Y={},y={};return Y.m=a,Y.d=p,Y.n=LunarCalendar.JieQi[2*a-2],y.m=a,y.d=M,y.n=LunarCalendar.JieQi[2*a-1],S.m=a,S.d=n,p===n&&(S.n=LunarCalendar.JieQi[2*a-2]),M===n&&(S.n=LunarCalendar.JieQi[2*a-1]),i=Date.UTC(c,a-1,1,0,0,0,0)/s+25567+10,A=LunarCalendar.toGanZhi(i+n-1),{is:{ok:1,today:r,leapYear:h},week:t,solar:{y:c,m:a,d:n},lunar:{y:o,m:L,d:C},gz:{y:m,m:k,d:A},jq:{j:Y,q:y,now:S},iso8601:{solar:c+"-"+a+"-"+n,lunar:o+"-"+L+"-"+C}}}static lunarNow(){let b;const f=LunarCalendar.convTimeToGanZhi(),e=LunarCalendar.convSolarToLunar();return b=f.now.h.toString().padStart(2,"0")==f.sci.t1.h?f.sci.t1.n:f.sci.t2.n,{time:{now:f.now,hisart:{name:f.sci.desc.n,desc:f.sci.desc.d},ganzhi:{name:f.sci.name,nick:f.sci.nick,hour:b,geng:f.sci.geng,mins:f.sci.mins}},week:{zh:e.week.zh,abbr:e.week.abbr,en:e.week.en},year:{now:{solar:e.solar,lunar:e.lunar},gz:e.gz,jq:{j:e.jq.j,q:e.jq.q}}}}}
