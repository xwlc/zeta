#!/usr/bin/env bash
# SPDX-License-Identifier: GPL-3.0-only OR Apache-2.0 OR MIT
# SPDX-FileCopyrightText: 2023 Charles Wong <charlie-wong@outlook.com>
# Created By: Charles Wong 2023-11-25T09:50:43+08:00 Asia/Shanghai
# Repository: https://github.com/xwlc/zeta

if ! command -v apt > /dev/null; then
  exit 1
fi

# `sudo apt upgrade` 显示 packages have been kept back
# 显示 kept-back 包阶段更新百分比(Phased-Update-Percentage)

for PKG in $(apt list --upgradable 2>&1 | grep / | cut -d/ -f1); do
  printf "%30s -> ${PKG}\n" "$(apt show "${PKG}" 2>&1 | grep Phased)"
done

exit 0

while read PKG; do
  printf "%30s -> ${PKG}\n" "$(apt show "${PKG}" 2>&1 | grep Phased)"
done < <(apt list --upgradable 2>&1 | grep / | cut -d/ -f1)
